var Lyric=function(){"use strict";const i=/^(?:\[[\d:.]+\])+/g,t=/\d{1,3}(:\d{1,3}){0,2}(?:\.\d{1,3})/g,e={title:"ti",artist:"ar",album:"al",offset:"offset",by:"by"},s="object"==typeof performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),n={invokeTime:0,animationFrameId:null,timeoutId:null,callback:()=>{},thresholdTime:200,run(){this.animationFrameId=window.requestAnimationFrame((()=>{this.animationFrameId=null;let i=this.invokeTime-s();if(i>0)return i<this.thresholdTime?this.run():this.timeoutId=setTimeout((()=>{this.timeoutId=null,this.run()}),i-this.thresholdTime);this.callback(i)}))},start(i=(()=>{}),t=0){this.callback=i,this.invokeTime=s()+t,this.run()},clear(){this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null)}},r=/^0+(\d+)/,h=/:0+(\d+)/g,a=/\.0+(\d+)/,l=i=>i.replace(r,"$1").replace(h,":$1").replace(a,".$1"),c=(e,s)=>{const n=s.split(/\r\n|\n|\r/);for(let s=0;s<n.length;s++){const r=n[s].trim();let h=i.exec(r);if(h){const s=h[0],n=r.replace(i,"").trim();if(n){const i=s.match(t);if(null==i)continue;for(let t of i){const i=e[l(t)];i&&i.extendedLyrics.push(n)}}}}};
/*!
     * lrc-file-parser.js v2.3.2
     * Author: lyswhut
     * Github: https://github.com/lyswhut/lrc-file-parser
     * License: MIT
     */
return class{constructor({lyric:i="",extendedLyrics:t=[],offset:e=150,playbackRate:s=1,onPlay:n=function(){},onSetLyric:r=function(){},isRemoveBlankLine:h=!0}={}){this.lyric=i,this.extendedLyrics=t,this.tags={title:"",artist:"",album:"",offset:"",by:""},this.lines=[],this.onPlay=n,this.onSetLyric=r,this.isPlay=!1,this.curLineNum=0,this.maxLine=0,this.offset=e,this._playbackRate=s,this._performanceTime=0,this._startTime=0,this.isRemoveBlankLine=h,this._init()}_init(){null==this.lyric&&(this.lyric=""),null==this.extendedLyrics&&(this.extendedLyrics=[]),this._initTag(),this._initLines(),this.onSetLyric(this.lines)}_initTag(){this.tags={title:"",artist:"",album:"",offset:"",by:""};for(let i in e){const t=this.lyric.match(new RegExp(`\\[${e[i]}:([^\\]]*)]`,"i"));this.tags[i]=t&&t[1]||""}if(this.tags.offset){let i=parseInt(this.tags.offset);this.tags.offset=Number.isNaN(i)?0:i}else this.tags.offset=0}_initLines(){this.lines=[];const e=this.lyric.split(/\r\n|\n|\r/),s={},n=e.length;for(let r=0;r<n;r++){const n=e[r].trim();let h=i.exec(n);if(h){const e=h[0],r=n.replace(i,"").trim();if(r||!this.isRemoveBlankLine){const i=e.match(t);if(null==i)continue;for(let t of i){const i=l(t);if(s[i]){s[i].extendedLyrics.push(r);continue}const e=i.split(":");if(!(e.length>3)){if(e.length<3)for(let i=3-e.length;i--;)e.unshift("0");e[2].indexOf(".")>-1&&e.splice(2,1,...e[2].split(".")),s[i]={time:60*parseInt(e[0])*60*1e3+60*parseInt(e[1])*1e3+1e3*parseInt(e[2])+parseInt(e[3]||"0"),text:r,extendedLyrics:[]}}}}}}for(const i of this.extendedLyrics)c(s,i);this.lines=Object.values(s),this.lines.sort(((i,t)=>i.time-t.time)),this.maxLine=this.lines.length-1}_currentTime(){return(s()-this._performanceTime)*this._playbackRate+this._startTime}_findCurLineNum(i,t=0){var e;if(i<=0)return 0;const s=(null===(e=this.lines)||void 0===e?void 0:e.length)||0;for(let e=t;e<s;e++)if(i<=this.lines[e].time)return 0===e?0:e-1;return s-1}_handleMaxLine(){this.onPlay(this.curLineNum,this.lines[this.curLineNum].text),this.pause()}_refresh(){if(this.curLineNum++,this.curLineNum>=this.maxLine)return this._handleMaxLine();let i=this.lines[this.curLineNum];const t=this._currentTime(),e=t-i.time;if(e>=0||0===this.curLineNum){const s=(this.lines[this.curLineNum+1].time-i.time-e)/this._playbackRate;if(s>0)this.isPlay&&n.start((()=>{this.isPlay&&this._refresh()}),s),this.onPlay(this.curLineNum,i.text);else{let i=this._findCurLineNum(t,this.curLineNum+1);i>this.curLineNum&&(this.curLineNum=i-1),this._refresh()}}else this.curLineNum=this._findCurLineNum(t,this.curLineNum)-1,this._refresh()}play(i=0){this.lines.length&&(this.pause(),this.isPlay=!0,this._performanceTime=s()-parseInt((this.tags.offset+this.offset).toString()),this._startTime=i,this.curLineNum=this._findCurLineNum(this._currentTime())-1,this._refresh())}pause(){if(!this.isPlay)return;if(this.isPlay=!1,n.clear(),this.curLineNum===this.maxLine)return;const i=this._findCurLineNum(this._currentTime());this.curLineNum!==i&&(this.curLineNum=i,this.onPlay(i,this.lines[i].text))}setPlaybackRate(i){this._playbackRate=i,this.lines.length&&this.isPlay&&this.play(this._currentTime())}setLyric(i,t=[]){this.isPlay&&this.pause(),this.lyric=i,this.extendedLyrics=t,this._init()}}}();
//# sourceMappingURL=lrc-file-parser.min.js.map
